**О компании**

«Тёплый дом» — это небольшая компания, которая организует удалённое управление отоплением в доме. Недавно она выиграла тендер и получила заказ на создание экосистемы умных посёлков на территории нескольких регионов страны.

Для выполнения заказа компании нужно расширить функционал своей системы и масштабировать её. Пользователи должны иметь возможность управлять не только отоплением, но и умными устройствами в доме. Чтобы подключиться к экосистеме, в домах должны быть установлены специальные датчики и реле. Сейчас они есть только в половине домов, которые хотят подключиться.

Состояние компании в настоящий момент не позволяет в полной мере реализовать новые бизнес-цели. Для этого требуется пересмотр и оптимизация всей экосистемы.

**Текущее решение**

- Нынешнее приложение компании позволяет только управлять отоплением в доме и проверять температуру.
- Каждая установка сопровождается выездом специалиста по подключению системы отопления в доме к текущей версии системы.
- Архитектура приложения представляет из себя монолит на Go с СУБД Postgres. Всё синхронно. Никаких асинхронных вызовов, микросервисов и реактивного взаимодействия в системе нет. Всё управление идёт от сервера к датчику. Данные о температуре также получаются через запрос от сервера к датчику.
- Самостоятельно подключить свой датчик к системе пользователь не может.

**Целевая экосистема, которую необходимо создать**

- Экосистема доступна пользователю в режиме самообслуживания по модели SaaS.
- Позволяет управлять отоплением, включать и выключать свет, запирать и отпирать автоматические ворота, удалённо наблюдать за домом, возможно и будущее неуточнённое поведение.
- Пользователь самостоятельно выбирает необходимые ему модули умного дома (устройства), сам их подключает, настраивает сценарии работы и просматривает телеметрию.
- Компания не занимается производством устройств, но поддерживает подключение к экосистеме устройств партнеров по стандартным протоколам.

**Требования к экосистеме**

- Модули управления приборами и сами приборы (устройства) должны быть максимально готовы к использованию и продаваться в отдельных комплектах для удобной покупки и подключения.
- Устройства должны быть доступны через интернет (для удалённого наблюдения и доступа). Предполагается, что пользователь будет иметь интернет-канал, к которому их можно подключить.
- Покупатели могут программировать систему для управления различными модулями в соответствии со своими потребностями.

**Лэндскейп компании**

Над проектом работают:
- Команда разработчиков. В ней пять человек. Они будут работать над рефакторингом и разделением монолита на микросервисы.
- Команда QA. В ней три человека. Они будут проводить тестирование новой системы.
- Команда по обслуживанию клиентов. Эту команду из десяти человек обучат работе с новой системой, чтобы они смогли предоставлять поддержку пользователям.
- Команда по продажам и маркетингу. Их пять человек. Они будут заниматься продвижением новых модульных комплектов.

Сейчас развёрнуто монолитное приложение на Go с PostgreSQL в качестве СУБД. У приложения 100 веб-клиентов, к системе подключены 100 модулей управления отоплением.

**Цели бизнеса**

- Описана As-Is и To-Be архитектура решения. Создан план по переходу к целевой системе.
- Разработан MVP с разделёнными микросервисами для управления отоплением, освещением, наблюдением, воротами. Продуман вариант подключения еще неизвестных датчиков.

--------
Рассуждения по предметной области, не имеющие прямого отношения к задаче:
1) Оборудование, установленное в доме разделяется на "конечное устройство" (датчик, реле) и "контроллер" (логика) - по терминологии Димы.
Вряд ли возможно просто взять и вынести "контроллер" в SAAS:
- ненадежный канал
- медленная скорость передачи данных
- необходимость управления устройствами на месте (не только через веб-интерфейс SAAS).

Абстрагируясь от деталей реализации, под сущностью Внешнее Устройство (относительно SAAS) будем понимать связку конечное устройство + логика, обеспечивающая немедленное управление конечным устройством.

2) Направление связи SAAS - Внешнее устройство. По условиям задачи взаимодействие в исходной системе идет от сервера к датчику.
В целевой системе "Предполагается, что пользователь будет иметь интернет-канал, к которому их можно подключить".
Для связи в направлении облако -> внешнее устройство - необходимо, чтобы устройство имело статический ip.
Также в жизни для повышения надежности связи может быть несколько каналов взаимодействия устройств с облаком: оптоволокно, моб сети (gprs, sms).

В рамках решения задачи будем считать, что Внешнее устройство может участвовать как в push, так и в pull-взаимодействии.
